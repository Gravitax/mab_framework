import{__is_mobile as c}from"../../mab.js";const a=(t,o)=>{const e=o.getBoundingClientRect(),l=parseFloat(window.getComputedStyle(o).marginBottom),n=e.top+e.height+document.documentElement.scrollTop-l;t.setAttribute("style",`top: ${n}px; left: ${e.left}px; width: ${e.width}px`)},m=(t,o,e)=>{const l=document.querySelector("[name='ville']"),n=document.querySelector("[name='cp']"),i=document.querySelector("[name='lieu']");l&&(l.value=e.ville),n&&(n.value=e.code_postal),i&&(i.value=e.value),t.classList.remove("active"),o.value=e.value},s=t=>{const o=t.querySelectorAll(".mab_completion__element");o&&o.forEach(e=>{e.remove()})},r=(t,o)=>{const e=document.getElementById("mab_completion__list");e&&(s(e),t&&t.forEach(l=>{const n=document.createElement("li");n.className="mab_completion__element",n.innerHTML=l.value,n.addEventListener("click",()=>{m(e,o,l)},{passive:!0}),e.append(n)}),a(e,o))},_=()=>{let t=document.getElementById("mab_completion__list");return t||(t=document.createElement("ul"),t.id="mab_completion__list",document.body.append(t),c[1]==!1&&document.addEventListener("click",o=>{const e=o.target;e&&!e.classList.contains("mab_completion__element")&&t&&t.classList.remove("active")},{passive:!0})),t},d=(t,o)=>{const e=_();r(t,o),e.classList.add("active")},p=t=>{if(t==27){const o=document.getElementById("mab_completion__list");o&&o.classList.remove("active")}return t>=48&&t<=90||t==189||t==222||t==46||t==8},u=(t,o)=>{const e=o.getAttribute("data-href");if(!e||!p(t.keyCode))return;const l=o.value;if(l&&l.length>1)fetch(`${e}${l}`).then(n=>n.json()).then(n=>{Object.keys(n).length&&d(n,o)});else{const n=document.getElementById("mab_completion__list");n&&(n.classList.remove("active"),s(n))}},v=()=>{const t=document.createElement("style");t.innerHTML=`
		.mab_completion { position: relative; }
		#mab_completion__list {
			position: absolute; z-index: -101;
			background-color: white; color: black;
			font-size: max(.8vw, 11px); line-height: 1em;
			//margin-block-start: 0;
			padding-inline-start: 0;
			margin-bottom: 0;
			opacity: 0;
			border-radius: 5px;
			transition: all 0.3s ease;
		}
		#mab_completion__list.active {
			z-index: 2147483647; opacity: 1;
		}
		#mab_completion__list li {
			width: 100%;
			margin-bottom: 0; padding: 1em;
			list-style: none;
			transition: all 0.3s ease;
		}
		#mab_completion__list li:hover {
			background-color: #f7f7f7;
			cursor: pointer;
		}
	`,document.head.append(t)},f=()=>{const t=document.querySelectorAll(".mab_completion");v(),t&&t.forEach(o=>{o.tagName==="INPUT"&&o.addEventListener("keyup",e=>{u(e,o)})})};export{f as default};
